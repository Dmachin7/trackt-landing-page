<section id="waitlist" class="relative overflow-hidden px-5 py-20 md:py-28">

  <!-- Ambient glow -->
  <div class="pointer-events-none absolute left-1/2 top-1/2 h-[400px] w-[700px] -translate-x-1/2 -translate-y-1/2 rounded-full bg-brand-primary/10 blur-[100px]"></div>

  <div class="relative z-10 mx-auto max-w-2xl">
    <div class="scroll-reveal opacity-0 translate-y-8 transition-all duration-700 ease-out">

      <!-- Card -->
      <div class="rounded-2xl border border-border-subtle bg-bg-card p-6 text-center shadow-[0_0_60px_rgba(22,180,210,0.06)] backdrop-blur-sm md:p-10">

        <!-- Badge -->
        <div class="mb-5 inline-flex items-center gap-1.5 rounded-full border border-brand-primary/30 bg-brand-primary/10 px-3.5 py-1.5 text-sm font-medium text-brand-primary">
          <span class="h-1.5 w-1.5 rounded-full bg-brand-primary animate-pulse"></span>
          Coming soon
        </div>

        <h2 class="text-3xl font-bold md:text-4xl">
          Be the first to know when we launch
        </h2>
        <p class="mx-auto mt-4 max-w-md text-text-secondary md:text-lg">
          Join the waitlist. No spam â€” just a heads-up when Trackt is ready for you.
        </p>

        <!-- Perks -->
        <div class="mt-6 flex flex-wrap items-center justify-center gap-x-5 gap-y-2 text-sm text-text-secondary">
          <span class="flex items-center gap-1.5">
            <svg class="h-4 w-4 text-brand-primary shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
            Free trial for early access members
          </span>
          <span class="flex items-center gap-1.5">
            <svg class="h-4 w-4 text-brand-primary shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
            Help shape the product
          </span>
          <span class="flex items-center gap-1.5">
            <svg class="h-4 w-4 text-brand-primary shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
            Priority onboarding
          </span>
        </div>

        <!-- Form -->
        <form id="waitlist-form" novalidate class="mt-8">
          <div class="flex flex-col gap-3 sm:flex-row">
            <input
              id="waitlist-email"
              type="email"
              name="email"
              placeholder="your@email.com"
              required
              autocomplete="email"
              inputmode="email"
              class="min-w-0 flex-1 rounded-xl border border-border-subtle bg-white/[0.04] px-4 py-3.5 text-base text-text-primary placeholder-text-secondary/50 outline-none transition-all focus:border-brand-primary/60 focus:ring-2 focus:ring-brand-primary/20"
            />
            <button
              type="submit"
              id="waitlist-btn"
              class="flex w-full items-center justify-center gap-2 rounded-xl bg-brand-primary px-6 py-3.5 text-base font-semibold text-white transition-all hover:brightness-110 hover:shadow-[0_0_30px_var(--color-brand-glow)] disabled:cursor-not-allowed disabled:opacity-60 sm:w-auto"
            >
              <span id="waitlist-btn-text">Join Waitlist</span>
              <svg id="waitlist-btn-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
            </button>
          </div>

          <!-- Error message -->
          <p id="waitlist-error" class="mt-3 hidden text-sm font-medium text-red-400"></p>
        </form>

        <!-- Success state (hidden by default) -->
        <div id="waitlist-success" class="mt-8 hidden">
          <div class="flex flex-col items-center gap-3">
            <div class="flex h-12 w-12 items-center justify-center rounded-full bg-emerald-500/15">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-emerald-400"><path d="M20 6 9 17l-5-5"/></svg>
            </div>
            <p class="text-lg font-semibold text-text-primary">You're on the list!</p>
            <p class="text-sm text-text-secondary">We'll send you a note the moment Trackt launches.</p>
          </div>
        </div>

        <p class="mt-5 text-xs text-text-secondary">
          No credit card required &middot; Unsubscribe anytime
        </p>
      </div>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById("waitlist-form") as HTMLFormElement | null;
  const emailInput = document.getElementById("waitlist-email") as HTMLInputElement | null;
  const btn = document.getElementById("waitlist-btn") as HTMLButtonElement | null;
  const btnText = document.getElementById("waitlist-btn-text");
  const btnIcon = document.getElementById("waitlist-btn-icon");
  const errorMsg = document.getElementById("waitlist-error");
  const successDiv = document.getElementById("waitlist-success");

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = emailInput?.value?.trim() ?? "";

    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      if (errorMsg) {
        errorMsg.textContent = "Please enter a valid email address.";
        errorMsg.classList.remove("hidden");
      }
      return;
    }

    errorMsg?.classList.add("hidden");
    if (btn) btn.disabled = true;
    if (btnText) btnText.textContent = "Joining...";
    if (btnIcon) btnIcon.classList.add("hidden");

    try {
      const res = await fetch("/api/subscribe", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email }),
      });

      const data = await res.json();

      if (res.ok && data.ok) {
        form.classList.add("hidden");
        successDiv?.classList.remove("hidden");
      } else {
        throw new Error(data.error ?? "Something went wrong.");
      }
    } catch (err) {
      if (errorMsg) {
        errorMsg.textContent = err instanceof Error ? err.message : "Something went wrong. Please try again.";
        errorMsg.classList.remove("hidden");
      }
      if (btn) btn.disabled = false;
      if (btnText) btnText.textContent = "Join Waitlist";
      if (btnIcon) btnIcon.classList.remove("hidden");
    }
  });
</script>
